<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Irys AI Reply Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Tailwind configuration to ensure Inter font is used
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'inter': ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.3s ease;
        }
        .gradient-text {
            background-image: linear-gradient(to right, #60a5fa, #a855f7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .animate-spin-slow {
            animation: spin 3s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-slate-900 text-white min-h-screen flex items-center justify-center p-4">

    <div class="max-w-2xl w-full p-6 md:p-10 bg-slate-800 rounded-2xl shadow-xl flex flex-col items-center">
        
        <!-- Header Section -->
        <div class="flex items-center space-x-3 mb-6">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-purple-400 animate-spin-slow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z"></path>
                <path d="M8 12h8M12 8v8"></path>
            </svg>
            <h1 class="text-3xl font-bold gradient-text">Irys Reply Bot</h1>
        </div>
        
        <!-- Description Text -->
        <p class="text-gray-400 text-center mb-8">
            Paste a tweet and get a smart, on-topic reply generated by AI, ready to post.
        </p>

        <!-- Main Input Area for the Tweet -->
        <textarea
            id="tweetInput"
            class="w-full h-32 p-4 mb-4 bg-slate-700 text-gray-200 border border-slate-600 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 placeholder-gray-500 transition-colors resize-none"
            placeholder="e.g., 'Permanent data storage on a blockchain seems like the holy grail for Web3. What are the current challenges?'"
        ></textarea>

        <!-- Action Buttons -->
        <div class="flex flex-col sm:flex-row w-full space-y-4 sm:space-y-0 sm:space-x-4">
            <!-- Generate Button -->
            <button
                id="generateBtn"
                class="w-full px-6 py-3 bg-purple-600 text-white font-semibold rounded-xl shadow-lg hover:bg-purple-700 transition-colors focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 focus:ring-offset-slate-800 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed"
            >
                <svg id="generateIcon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20h9"/><path d="M12 4h9"/><path d="M12 12h9"/><path d="M3 20l3.5-3.5"/><path d="M3 4l3.5 3.5"/><path d="M3 12l3.5 3.5"/></svg>
                <svg id="loadingIcon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 hidden animate-spin" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12a9 9 0 1 1-6.219-8.56"/><path d="M21 12h-4"/><path d="M17 19l4-4-4-4"/></svg>
                <span id="buttonText">Generate Reply</span>
            </button>
            <!-- Copy Button -->
            <button
                id="copyBtn"
                class="w-full px-6 py-3 bg-blue-600 text-white font-semibold rounded-xl shadow-lg hover:bg-blue-700 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:ring-offset-slate-800 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center"
                disabled
            >
                <svg id="copyIcon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>
                Copy Reply
            </button>
        </div>

        <!-- Output Area for the Generated Reply -->
        <div id="outputContainer" class="w-full mt-8 hidden">
            <h2 class="text-xl font-bold text-gray-200 mb-4">
                Generated Reply
            </h2>
            <div id="replyOutput" class="p-6 bg-slate-700 text-gray-300 rounded-xl leading-relaxed whitespace-pre-wrap"></div>
        </div>

        <!-- Custom Message Box for Notifications -->
        <div id="messageBox" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
            <div class="bg-slate-800 p-6 rounded-lg shadow-2xl max-w-sm w-full text-center border-2 border-purple-500">
                <p id="messageText" class="text-gray-200 mb-4"></p>
                <button id="messageBoxClose" class="px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 transition-colors">
                    Close
                </button>
            </div>
        </div>
    </div>

    <script>
        // Get all the necessary DOM elements
        const tweetInput = document.getElementById('tweetInput');
        const generateBtn = document.getElementById('generateBtn');
        const copyBtn = document.getElementById('copyBtn');
        const buttonText = document.getElementById('buttonText');
        const generateIcon = document.getElementById('generateIcon');
        const loadingIcon = document.getElementById('loadingIcon');
        const outputContainer = document.getElementById('outputContainer');
        const replyOutput = document.getElementById('replyOutput');
        const messageBox = document.getElementById('messageBox');
        const messageText = document.getElementById('messageText');
        const messageBoxClose = document.getElementById('messageBoxClose');

        // Function to show a custom message box instead of browser alert()
        const showMessage = (text) => {
            messageText.textContent = text;
            messageBox.classList.remove('hidden');
        };

        // Close the message box when the button is clicked
        messageBoxClose.addEventListener('click', () => {
            messageBox.classList.add('hidden');
        });

        // Set the loading state for the buttons and UI
        const setLoading = (isLoading) => {
            generateBtn.disabled = isLoading;
            copyBtn.disabled = isLoading;
            if (isLoading) {
                buttonText.textContent = 'Generating...';
                generateIcon.classList.add('hidden');
                loadingIcon.classList.remove('hidden');
            } else {
                buttonText.textContent = 'Generate Reply';
                generateIcon.classList.remove('hidden');
                loadingIcon.classList.add('hidden');
            }
        };

        // Main function to handle the AI reply generation
        generateBtn.addEventListener('click', async () => {
            const tweet = tweetInput.value.trim();
            if (!tweet) {
                showMessage('Please enter a tweet to get a reply.');
                return;
            }
            
            // Reset UI state before starting the generation
            setLoading(true);
            outputContainer.classList.add('hidden');
            replyOutput.textContent = '';
            copyBtn.disabled = true;

            // Construct the prompt for the AI model
            const prompt = `You are an expert on Irys, a layer-1 blockchain with a programmable datachain. Your goal is to generate a short, insightful, and engaging reply to the following tweet. The reply should be helpful, concise, and demonstrate a clear understanding of how Irys's features like permanent storage, programmable data, and verifiable compute can solve the problem or relate to the topic in the tweet. Do not use generic phrases like "Great point!" or "Interesting thought!". Be specific, enthusiastic, and direct.

Tweet to reply to: "${tweet}"

Example Reply: "This is a perfect use case for Irys's programmable data! You could embed logic directly into the data to trigger a smart contract when specific conditions are met. This is a game-changer for on-chain automation. #Irys"

Now, generate a reply for the tweet:`;

            // Prepare the payload for the Gemini API call
            let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
            const payload = { contents: chatHistory };
            const apiKey = ""; // The platform will inject the API key here
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            let retries = 0;
            const maxRetries = 5;

            // Asynchronous function for fetching data with exponential backoff
            const fetchData = async () => {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    // Check for a non-OK response and throw an error
                    if (!response.ok) {
                        throw new Error(`API call failed with status: ${response.status}`);
                    }

                    // Parse the JSON response
                    const result = await response.json();
                    const text = result?.candidates?.[0]?.content?.parts?.[0]?.text;

                    if (text) {
                        // Display the generated reply
                        replyOutput.textContent = text;
                        outputContainer.classList.remove('hidden');
                        copyBtn.disabled = false;
                    } else {
                        // Handle cases where the response is missing content
                        showMessage('Failed to get a response from the model. Please try again.');
                    }
                } catch (e) {
                    // Handle API errors with exponential backoff
                    if (retries < maxRetries) {
                        const delay = Math.pow(2, retries) * 1000;
                        console.error(`API call failed, retrying in ${delay}ms...`, e);
                        retries++;
                        setTimeout(fetchData, delay);
                    } else {
                        // Show a user-friendly error message after all retries fail
                        console.error('API call failed after multiple retries.', e);
                        showMessage('An error occurred. Please check your network connection and try again.');
                    }
                } finally {
                    // Ensure the loading state is reset after a successful response or final failure
                    if (retries >= maxRetries || outputContainer.classList.contains('hidden') === false) {
                        setLoading(false);
                    }
                }
            };
            fetchData();
        });

        // Copy the generated reply to the clipboard
        copyBtn.addEventListener('click', () => {
            const replyText = replyOutput.textContent;
            if (replyText) {
                // Use the clipboard API to copy the text
                navigator.clipboard.writeText(replyText).then(() => {
                    showMessage('Reply copied to clipboard!');
                }).catch(err => {
                    showMessage('Failed to copy text. Please try again or copy manually.');
                    console.error('Copy to clipboard failed: ', err);
                });
            }
        });
    </script>
</body>
</html>
